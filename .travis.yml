sudo: required
services:
  - docker
language: bash
env:
  - IMAGE_NAME=nginx  IMAGE_ARCH=amd64
  - IMAGE_NAME=nginx  IMAGE_ARCH=i386
  - IMAGE_NAME=nginx  IMAGE_ARCH=arm32v7
  - IMAGE_NAME=nginx  IMAGE_ARCH=arm64v8

install:
  - |
    docker run --rm --privileged multiarch/qemu-user-static:register --reset
#    echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
#    docker pull $DOCKER_USERNAME/$IMAGE_NAME:$IMAGE_ARCH || true

script:
  - |
    cd $IMAGE_NAME/$IMAGE_ARCH
    docker build -t $DOCKER_USERNAME/$IMAGE_NAME:$IMAGE_ARCH .

after_script:
  - |
    if [ $IMAGE_ARCH = "amd64" ]; then
      docker tag $DOCKER_USERNAME/$IMAGE_NAME:amd64 $DOCKER_USERNAME/$IMAGE_NAME:latest
    fi
    docker images